<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é»‘æ´æ¢ç´¢ - æŸ³æ™ºå¤©çš„å®‡å®™è¯¾å ‚</title>
    <link rel="preconnect" href="https://fonts.loli.net">
    <link rel="preconnect" href="https://fonts.loli.net" crossorigin>
    <link href="https://fonts.loli.net/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --cosmic-dark: #0a0a0f;
            --nebula-purple: #1a0a2e;
            --stellar-blue: #16213e;
            --accent-gold: #f4d03f;
            --accent-orange: #e67e22;
            --accent-cyan: #00d4ff;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: var(--cosmic-dark);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            cursor: grab;
        }

        body.grabbing { cursor: grabbing; }

        /* ============ åŠ è½½åŠ¨ç”» ============ */
        .loading-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: var(--cosmic-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.6s ease;
        }

        .loading-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .loading-blackhole {
            width: 100px;
            height: 100px;
            position: relative;
        }

        .loading-blackhole .core {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #111 60%, transparent 100%);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px 5px rgba(0,0,0,0.8);
        }

        .loading-blackhole .disk {
            position: absolute;
            inset: 0;
            border: 3px solid transparent;
            border-top-color: var(--accent-gold);
            border-right-color: var(--accent-orange);
            border-radius: 50%;
            animation: spin-disk 1.2s linear infinite;
        }

        .loading-blackhole .disk:nth-child(2) {
            inset: 10px;
            border-top-color: var(--accent-cyan);
            border-right-color: rgba(0, 212, 255, 0.3);
            animation-duration: 1.8s;
            animation-direction: reverse;
        }

        @keyframes spin-disk {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 24px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            letter-spacing: 2px;
        }

        /* ============ æ˜Ÿç©ºèƒŒæ™¯ ============ */
        .stars-bg {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
        }

        .stars-bg .star {
            position: absolute;
            border-radius: 50%;
            background: #fff;
            animation: twinkle 3s infinite alternate;
        }

        @keyframes twinkle {
            0% { opacity: 0.2; }
            100% { opacity: 1; }
        }

        /* ============ å¸å…¥ç²’å­ ============ */
        .particle {
            position: fixed;
            width: 3px;
            height: 3px;
            background: var(--accent-gold);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            animation: particle-drift linear infinite;
        }

        @keyframes particle-drift {
            0% { opacity: 0; transform: translate(0, 0) scale(1); }
            20% { opacity: 0.8; }
            80% { opacity: 0.4; }
            100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0.1); }
        }

        /* ============ é¡¶éƒ¨ Header ============ */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(180deg, rgba(10, 10, 15, 0.95) 0%, transparent 100%);
            pointer-events: none;
        }

        .header > * { pointer-events: auto; }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: radial-gradient(circle, #111 30%, var(--accent-gold) 60%, var(--accent-orange) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 0 25px rgba(244, 208, 63, 0.5);
            animation: pulse-glow 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            inset: -2px;
            border: 2px solid transparent;
            border-top-color: var(--accent-gold);
            border-radius: 50%;
            animation: spin-disk 3s linear infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 25px rgba(244, 208, 63, 0.4); }
            50% { box-shadow: 0 0 45px rgba(244, 208, 63, 0.7); }
        }

        .logo-text h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-gold), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
        }

        .logo-text p {
            font-size: 0.75rem;
            color: var(--text-secondary);
            letter-spacing: 1px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-labels-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            padding: 8px 14px;
            border-radius: 20px;
            color: var(--text-primary);
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .toggle-labels-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-cyan);
        }

        .toggle-labels-btn.active {
            background: rgba(0, 212, 255, 0.15);
            border-color: var(--accent-cyan);
        }

        /* ============ å›¾ç‰‡æŸ¥çœ‹å™¨ ============ */
        .viewer {
            position: fixed;
            inset: 0;
            z-index: 2;
            overflow: hidden;
        }

        .viewer-content {
            position: absolute;
            top: 0;
            left: 0;
            transform-origin: 0 0;
            will-change: transform;
            transition: none;
        }

        .viewer-content.smooth {
            transition: transform 0.3s ease;
        }

        .viewer-content img {
            display: block;
            max-width: 90vw;
            max-height: 90vh;
            border-radius: 8px;
            user-select: none;
            -webkit-user-drag: none;
        }

        /* ============ SVG æ ‡æ³¨å±‚ ============ */
        .annotations-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .annotation {
            position: absolute;
            pointer-events: auto;
            cursor: pointer;
            z-index: 10;
        }

        .anno-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-cyan);
            box-shadow: 0 0 10px var(--accent-cyan);
            animation: anno-pulse 2s ease-in-out infinite;
            position: relative;
        }

        .anno-dot::after {
            content: '';
            position: absolute;
            inset: -6px;
            border: 1px solid var(--accent-cyan);
            border-radius: 50%;
            opacity: 0.4;
            animation: anno-ring 2s ease-in-out infinite;
        }

        @keyframes anno-pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.3); opacity: 1; }
        }

        @keyframes anno-ring {
            0%, 100% { transform: scale(1); opacity: 0.4; }
            50% { transform: scale(1.8); opacity: 0; }
        }

        .anno-label {
            position: absolute;
            left: 24px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(10, 10, 20, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 8px 14px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateY(-50%) translateX(-5px);
            pointer-events: none;
        }

        .annotation:hover .anno-label,
        .annotation.active .anno-label {
            opacity: 1;
            transform: translateY(-50%) translateX(0);
        }

        .anno-label .anno-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--accent-cyan);
            margin-bottom: 2px;
        }

        .anno-label .anno-desc {
            font-size: 0.7rem;
            color: var(--text-secondary);
            max-width: 200px;
            white-space: normal;
            line-height: 1.4;
        }

        .anno-line {
            position: absolute;
            left: 14px;
            top: 50%;
            width: 12px;
            height: 1px;
            background: var(--accent-cyan);
            opacity: 0.5;
        }

        .annotations-hidden .annotation { display: none; }

        /* ============ å¸ç§¯ç›˜ CSS ç²’å­åŠ¨ç”» ============ */
        .fx-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            overflow: visible;
        }

        /* è½¨é“å®¹å™¨ï¼šä¸€ä¸ªæ—‹è½¬çš„åœ†ï¼ŒscaleY å‹æ‰æˆæ¤­åœ† */
        .orbit-ring {
            position: absolute;
            border-radius: 50%;
            animation: orbit-spin var(--dur) linear infinite;
            animation-delay: var(--delay, 0s);
        }

        @keyframes orbit-spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* è½¨é“ä¸Šçš„å‘å…‰ç²’å­ */
        .orbit-dot {
            position: absolute;
            border-radius: 50%;
            /* åå‘ scaleY è®©ç²’å­ä¿æŒåœ†å½¢è€Œéè¢«å‹æ‰ */
            transform: translate(-50%, -50%) scaleY(var(--counter-scale, 1));
        }

        /* è„‰å†²é—ªçƒç²’å­ */
        .glow-dot {
            position: absolute;
            border-radius: 50%;
            animation: glow-pulse var(--glow-dur, 3s) ease-in-out infinite alternate;
            animation-delay: var(--glow-delay, 0s);
        }

        @keyframes glow-pulse {
            0% { opacity: 0.05; transform: translate(-50%, -50%) scale(0.8); }
            100% { opacity: var(--glow-max, 0.5); transform: translate(-50%, -50%) scale(1.2); }
        }

        /* ============ å·¦ä¾§çŸ¥è¯†é¢æ¿ ============ */
        .panel {
            position: fixed;
            top: 80px;
            left: 0;
            bottom: 80px;
            width: 340px;
            z-index: 200;
            background: rgba(10, 10, 20, 0.88);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            border-radius: 0 16px 16px 0;
            overflow-y: auto;
            overflow-x: hidden;
            transform: translateX(0);
            transition: transform 0.35s ease;
            padding: 16px;
        }

        .panel.collapsed {
            transform: translateX(-100%);
        }

        .panel-toggle {
            position: fixed;
            top: 50%;
            left: 340px;
            transform: translateY(-50%);
            z-index: 201;
            width: 28px;
            height: 60px;
            background: rgba(10, 10, 20, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-left: none;
            border-radius: 0 10px 10px 0;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: all 0.35s ease;
        }

        .panel.collapsed + .panel-toggle {
            left: 0;
        }

        .panel-toggle:hover {
            background: rgba(30, 30, 50, 0.9);
            color: var(--accent-cyan);
        }

        .panel-section {
            margin-bottom: 12px;
        }

        .panel-section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .panel-section-header:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: var(--accent-cyan);
        }

        .panel-section-header .sec-icon { font-size: 1.2rem; }
        .panel-section-header .sec-title {
            flex: 1;
            font-size: 0.9rem;
            font-weight: 700;
        }

        .panel-section-header .sec-arrow {
            font-size: 0.7rem;
            color: var(--text-secondary);
            transition: transform 0.3s ease;
        }

        .panel-section.open .sec-arrow {
            transform: rotate(180deg);
        }

        .panel-section-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.35s ease;
        }

        .panel-section.open .panel-section-body {
            max-height: 1000px;
        }

        .panel-section-content {
            padding: 12px 8px;
            font-size: 0.82rem;
            line-height: 1.7;
            color: var(--text-secondary);
        }

        .panel-section-content strong {
            color: var(--accent-gold);
        }

        /* ç»“æ„å¡ç‰‡ */
        .structure-card {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .structure-card:hover,
        .structure-card.active {
            background: rgba(0, 212, 255, 0.08);
            border-color: rgba(0, 212, 255, 0.3);
        }

        .structure-card .sc-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent-cyan);
            flex-shrink: 0;
            margin-top: 4px;
        }

        .structure-card .sc-name {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--accent-cyan);
            margin-bottom: 2px;
        }

        .structure-card .sc-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* æ—¶é—´çº¿ */
        .timeline {
            position: relative;
            padding-left: 20px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 5px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, var(--accent-gold), var(--accent-orange), #ff4444);
        }

        .timeline-item {
            position: relative;
            padding: 10px 0 10px 16px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -19px;
            top: 14px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent-gold);
            border: 2px solid var(--cosmic-dark);
        }

        .timeline-item:nth-child(2)::before { background: var(--accent-orange); }
        .timeline-item:nth-child(3)::before { background: #ff6b6b; }
        .timeline-item:nth-child(4)::before { background: #333; box-shadow: 0 0 8px rgba(0,0,0,0.8); }

        .timeline-item .tl-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: 4px;
        }

        .timeline-item .tl-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* ç¿»è½¬å¡ç‰‡ */
        .flip-card {
            perspective: 600px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            min-height: 70px;
            transition: transform 0.5s ease;
            transform-style: preserve-3d;
        }

        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-front, .flip-back {
            position: absolute;
            inset: 0;
            backface-visibility: hidden;
            border-radius: 10px;
            padding: 12px 14px;
            display: flex;
            align-items: center;
            font-size: 0.82rem;
            line-height: 1.5;
        }

        .flip-front {
            background: rgba(244, 208, 63, 0.08);
            border: 1px solid rgba(244, 208, 63, 0.2);
            color: var(--accent-gold);
            font-weight: 600;
        }

        .flip-front::after {
            content: 'ç‚¹å‡»æ­æ™“ â†’';
            position: absolute;
            right: 12px;
            bottom: 8px;
            font-size: 0.65rem;
            color: rgba(244, 208, 63, 0.4);
            font-weight: 400;
        }

        .flip-back {
            background: rgba(0, 212, 255, 0.08);
            border: 1px solid rgba(0, 212, 255, 0.2);
            color: var(--text-secondary);
            transform: rotateY(180deg);
        }

        /* ============ åº•éƒ¨å›¾ç‰‡åˆ‡æ¢ ============ */
        .image-switcher {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            display: flex;
            background: rgba(10, 10, 20, 0.85);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            overflow: hidden;
        }

        .img-switch-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 0.82rem;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .img-switch-btn.active {
            background: linear-gradient(135deg, rgba(244, 208, 63, 0.2), rgba(230, 126, 34, 0.2));
            color: var(--accent-gold);
            font-weight: 600;
        }

        .img-switch-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        /* ============ ç¼©æ”¾æ§åˆ¶ ============ */
        .zoom-controls {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 200;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            background: rgba(10, 10, 20, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-family: 'Noto Sans SC', sans-serif;
        }

        .zoom-btn:hover {
            background: rgba(30, 30, 50, 0.9);
            border-color: var(--accent-cyan);
        }

        .zoom-level {
            text-align: center;
            font-size: 0.65rem;
            color: var(--text-secondary);
            padding: 2px 0;
        }

        /* ============ é¦–é¡µé“¾æ¥ ============ */
        .home-link {
            position: fixed;
            bottom: 24px;
            left: 24px;
            z-index: 200;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: rgba(10, 10, 20, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .home-link:hover {
            background: rgba(30, 30, 50, 0.9);
            border-color: var(--accent-cyan);
            color: var(--text-primary);
        }

        /* ============ æ»šåŠ¨æ¡ ============ */
        .panel::-webkit-scrollbar { width: 4px; }
        .panel::-webkit-scrollbar-track { background: transparent; }
        .panel::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 2px;
        }

        /* ============ ç§»åŠ¨ç«¯é€‚é… ============ */
        @media (max-width: 768px) {
            .header { padding: 12px 16px; }
            .logo-icon { width: 36px; height: 36px; font-size: 16px; }
            .logo-text h1 { font-size: 1rem; }
            .logo-text p { font-size: 0.65rem; }

            .panel {
                width: 280px;
                top: 64px;
                bottom: 70px;
            }

            .panel-toggle {
                left: 280px;
            }

            .panel.collapsed + .panel-toggle {
                left: 0;
            }

            .image-switcher {
                bottom: 16px;
            }

            .img-switch-btn {
                padding: 8px 14px;
                font-size: 0.75rem;
            }

            .zoom-controls { bottom: 16px; right: 16px; }
            .zoom-btn { width: 36px; height: 36px; font-size: 1rem; }

            .home-link { bottom: 16px; left: 16px; padding: 8px 12px; font-size: 0.75rem; }

            .anno-label {
                max-width: 160px;
            }

            .anno-label .anno-desc {
                max-width: 140px;
                font-size: 0.65rem;
            }
        }

        @media (max-width: 480px) {
            .panel { width: 260px; }
            .panel-toggle { left: 260px; }
            .panel.collapsed + .panel-toggle { left: 0; }
            .logo-text p { display: none; }
            .toggle-labels-btn span:not(.tl-icon) { display: none; }
            .toggle-labels-btn { padding: 8px 10px; }
        }
    </style>
</head>
<body>
    <!-- åŠ è½½åŠ¨ç”» -->
    <div class="loading-overlay" id="loading">
        <div class="loading-blackhole">
            <div class="disk"></div>
            <div class="disk"></div>
            <div class="core"></div>
        </div>
        <div class="loading-text">æ­£åœ¨é è¿‘é»‘æ´...</div>
    </div>

    <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
    <div class="stars-bg" id="starsBg"></div>

    <!-- å¸å…¥ç²’å­ -->
    <div id="particles"></div>

    <!-- é¡¶éƒ¨ -->
    <div class="header">
        <div class="logo">
            <div class="logo-icon">ğŸ•³ï¸</div>
            <div class="logo-text">
                <h1>BLACK HOLE</h1>
                <p>æŸ³æ™ºå¤©çš„å®‡å®™è¯¾å ‚</p>
            </div>
        </div>
        <div class="header-right">
            <button class="toggle-labels-btn active" id="toggleLabelsBtn" onclick="toggleAnnotations()">
                <span class="tl-icon">ğŸ·ï¸</span>
                <span>æ ‡æ³¨</span>
            </button>
        </div>
    </div>

    <!-- å›¾ç‰‡æŸ¥çœ‹å™¨ -->
    <div class="viewer" id="viewer">
        <div class="viewer-content" id="viewerContent">
            <img id="bhImage" src="1.jpeg" alt="å¡å†ˆå›¾é›…é»‘æ´" draggable="false">
            <!-- ç²’å­åŠ¨ç”»å±‚ï¼ˆçº¯ CSSï¼Œé›¶ Canvas å¼€é”€ï¼‰ -->
            <div class="fx-layer" id="fxLayer"></div>
            <!-- æ ‡æ³¨å±‚ -->
            <div class="annotations-layer" id="annotationsLayer">
                <!-- æ ‡æ³¨ç”± JS ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- çŸ¥è¯†é¢æ¿ -->
    <div class="panel collapsed" id="panel">
        <!-- æ¿å—1: é»‘æ´æ˜¯ä»€ä¹ˆ -->
        <div class="panel-section open" data-section="intro">
            <div class="panel-section-header" onclick="toggleSection(this)">
                <span class="sec-icon">ğŸŒŒ</span>
                <span class="sec-title">é»‘æ´æ˜¯ä»€ä¹ˆï¼Ÿ</span>
                <span class="sec-arrow">â–¼</span>
            </div>
            <div class="panel-section-body">
                <div class="panel-section-content">
                    æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæŠŠ<strong>æ•´ä¸ªåœ°çƒ</strong>å‹ç¼©æˆä¸€é¢—<strong>å¼¹ç </strong>é‚£ä¹ˆå°ï¼Œå®ƒçš„å¼•åŠ›å°±ä¼šå¤§åˆ°è¿<strong>å…‰</strong>éƒ½è·‘ä¸å‡ºå»â€”â€”è¿™å°±æ˜¯é»‘æ´ï¼
                    <br><br>
                    é»‘æ´ä¸æ˜¯ä¸€ä¸ª"æ´"ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>è¶…çº§é‡</strong>çš„å¤©ä½“ã€‚å®ƒçš„å¼•åŠ›å¤ªå¼ºäº†ï¼Œä»»ä½•ä¸œè¥¿é å¾—å¤ªè¿‘éƒ½ä¼šè¢«å¸è¿›å»ï¼Œæ°¸è¿œå›ä¸æ¥ã€‚
                    <br><br>
                    ç”µå½±ã€Šæ˜Ÿé™…ç©¿è¶Šã€‹é‡Œçš„<strong>å¡å†ˆå›¾é›…</strong>å°±æ˜¯ä¸€ä¸ªè¶…å¤§è´¨é‡é»‘æ´ï¼Œå®ƒçš„è´¨é‡æ˜¯å¤ªé˜³çš„<strong>1äº¿å€</strong>ï¼
                </div>
            </div>
        </div>

        <!-- æ¿å—2: é»‘æ´ç»“æ„ -->
        <div class="panel-section" data-section="structure">
            <div class="panel-section-header" onclick="toggleSection(this)">
                <span class="sec-icon">ğŸ”¬</span>
                <span class="sec-title">é»‘æ´ç»“æ„</span>
                <span class="sec-arrow">â–¼</span>
            </div>
            <div class="panel-section-body">
                <div class="panel-section-content">
                    <div class="structure-card" data-anno="singularity" onclick="highlightAnno('singularity')">
                        <div class="sc-dot" style="background:#fff"></div>
                        <div>
                            <div class="sc-name">å¥‡ç‚¹</div>
                            <div class="sc-desc">é»‘æ´æœ€ä¸­å¿ƒï¼Œæ‰€æœ‰è´¨é‡è¢«å‹ç¼©åˆ°æ— é™å°çš„ä¸€ä¸ªç‚¹</div>
                        </div>
                    </div>
                    <div class="structure-card" data-anno="event-horizon" onclick="highlightAnno('event-horizon')">
                        <div class="sc-dot" style="background:#ff4444"></div>
                        <div>
                            <div class="sc-name">äº‹ä»¶è§†ç•Œ</div>
                            <div class="sc-desc">"ä¸å¯è¿”å›çº¿"â€”â€”è¶Šè¿‡å°±å›ä¸æ¥äº†ï¼Œè¿å…‰ä¹Ÿä¸è¡Œ</div>
                        </div>
                    </div>
                    <div class="structure-card" data-anno="photon-ring" onclick="highlightAnno('photon-ring')">
                        <div class="sc-dot" style="background:var(--accent-gold)"></div>
                        <div>
                            <div class="sc-name">å…‰å­ç¯</div>
                            <div class="sc-desc">å…‰ç»•ç€é»‘æ´è½¬åœˆå½¢æˆçš„æ˜äº®å…‰ç¯</div>
                        </div>
                    </div>
                    <div class="structure-card" data-anno="accretion-disk" onclick="highlightAnno('accretion-disk')">
                        <div class="sc-dot" style="background:var(--accent-orange)"></div>
                        <div>
                            <div class="sc-name">å¸ç§¯ç›˜</div>
                            <div class="sc-desc">è¢«å¸å…¥çš„ç‰©è´¨æ—‹è½¬å½¢æˆçš„è¶…é«˜æ¸©ç›˜</div>
                        </div>
                    </div>
                    <div class="structure-card" data-anno="gravitational-lensing" onclick="highlightAnno('gravitational-lensing')">
                        <div class="sc-dot" style="background:var(--accent-cyan)"></div>
                        <div>
                            <div class="sc-name">å¼•åŠ›é€é•œ</div>
                            <div class="sc-desc">é»‘æ´åƒæ”¾å¤§é•œä¸€æ ·å¼¯æ›²èƒŒåçš„å…‰çº¿</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¿å—3: é»‘æ´å½¢æˆ -->
        <div class="panel-section" data-section="formation">
            <div class="panel-section-header" onclick="toggleSection(this)">
                <span class="sec-icon">â­</span>
                <span class="sec-title">é»‘æ´æ€ä¹ˆå½¢æˆçš„ï¼Ÿ</span>
                <span class="sec-arrow">â–¼</span>
            </div>
            <div class="panel-section-body">
                <div class="panel-section-content">
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="tl-title">ğŸŒŸ å¤§æ’æ˜Ÿè¯ç”Ÿ</div>
                            <div class="tl-desc">ä¸€é¢—æ¯”å¤ªé˜³é‡ <strong>25 å€ä»¥ä¸Š</strong>çš„å·¨å¤§æ’æ˜Ÿåœ¨å®‡å®™ä¸­è¯ç”Ÿï¼Œç‡ƒçƒ§ç€æ ¸ç‡ƒæ–™ï¼Œå‘å‡ºè€€çœ¼çš„å…‰èŠ’</div>
                        </div>
                        <div class="timeline-item">
                            <div class="tl-title">ğŸ”¥ ç‡ƒæ–™è€—å°½</div>
                            <div class="tl-desc">å‡ ç™¾ä¸‡å¹´åï¼Œæ’æ˜ŸæŠŠç‡ƒæ–™çƒ§å®Œäº†ã€‚å°±åƒ<strong>ç¯ç«ç†„ç­</strong>ä¸€æ ·ï¼Œå®ƒå†ä¹Ÿæ”¯æ’‘ä¸ä½è‡ªå·±å·¨å¤§çš„èº«ä½“äº†</div>
                        </div>
                        <div class="timeline-item">
                            <div class="tl-title">ğŸ’¥ è¶…æ–°æ˜Ÿçˆ†ç‚¸</div>
                            <div class="tl-desc">æ’æ˜Ÿå¤–å±‚å‘ç”Ÿå‰§çƒˆçˆ†ç‚¸â€”â€”è¿™å°±æ˜¯<strong>è¶…æ–°æ˜Ÿ</strong>ï¼äº®åº¦è¶…è¿‡æ•´ä¸ªæ˜Ÿç³»ï¼Œæ˜¯å®‡å®™ä¸­æœ€å£®è§‚çš„çƒŸèŠ±</div>
                        </div>
                        <div class="timeline-item">
                            <div class="tl-title">ğŸ•³ï¸ é»‘æ´è¯ç”Ÿ</div>
                            <div class="tl-desc">çˆ†ç‚¸åï¼Œæ ¸å¿ƒåœ¨è‡ªèº«å¼•åŠ›ä¸‹<strong>æ— é™åç¼©</strong>ï¼Œå˜å¾—è¶Šæ¥è¶Šå°ã€è¶Šæ¥è¶Šé‡ï¼Œæœ€ç»ˆå½¢æˆé»‘æ´</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¿å—4: è¶£å‘³é—®ç­” -->
        <div class="panel-section" data-section="quiz">
            <div class="panel-section-header" onclick="toggleSection(this)">
                <span class="sec-icon">â“</span>
                <span class="sec-title">è¶£å‘³é—®ç­”</span>
                <span class="sec-arrow">â–¼</span>
            </div>
            <div class="panel-section-body">
                <div class="panel-section-content">
                    <div class="flip-card" onclick="this.classList.toggle('flipped')">
                        <div class="flip-card-inner">
                            <div class="flip-front">æ‰è¿›é»‘æ´ä¼šæ€æ ·ï¼Ÿ</div>
                            <div class="flip-back">ä½ ä¼šè¢«æ‹‰æˆæ„å¤§åˆ©é¢ï¼ç§‘å­¦å®¶å«å®ƒ<strong>"é¢æ¡åŒ–æ•ˆåº”"</strong>â€”â€”å› ä¸ºè„šæ¯”å¤´æ›´é è¿‘é»‘æ´ï¼Œå—åˆ°çš„å¼•åŠ›æ›´å¼ºï¼Œèº«ä½“ä¼šè¢«æ‹‰å¾—åƒé¢æ¡ä¸€æ ·é•¿ï¼</div>
                        </div>
                    </div>
                    <div class="flip-card" onclick="this.classList.toggle('flipped')">
                        <div class="flip-card-inner">
                            <div class="flip-front">é»‘æ´ä¼šæŠŠå®‡å®™å¸å…‰å—ï¼Ÿ</div>
                            <div class="flip-back">ä¸ä¼šï¼é»‘æ´çš„å¼•åŠ›åªåœ¨<strong>é è¿‘</strong>çš„æ—¶å€™æ‰å¾ˆå¼ºã€‚å¦‚æœå¤ªé˜³å˜æˆé»‘æ´ï¼Œåœ°çƒçš„è½¨é“ä¸ä¼šå˜â€”â€”åªæ˜¯ä¼šå˜å¾—å¾ˆå†·å¾ˆé»‘ï¼</div>
                        </div>
                    </div>
                    <div class="flip-card" onclick="this.classList.toggle('flipped')">
                        <div class="flip-card-inner">
                            <div class="flip-front">é»‘æ´é‡Œé¢çš„æ—¶é—´ä¼šæ€æ ·ï¼Ÿ</div>
                            <div class="flip-back">é è¿‘é»‘æ´ï¼Œ<strong>æ—¶é—´ä¼šå˜æ…¢</strong>ï¼åœ¨ã€Šæ˜Ÿé™…ç©¿è¶Šã€‹é‡Œï¼Œä¸»è§’åœ¨é»‘æ´æ—è¾¹å¾…äº†å‡ ä¸ªå°æ—¶ï¼Œåœ°çƒä¸Šå·²ç»è¿‡äº†<strong>23å¹´</strong>ï¼</div>
                        </div>
                    </div>
                    <div class="flip-card" onclick="this.classList.toggle('flipped')">
                        <div class="flip-card-inner">
                            <div class="flip-front">æˆ‘ä»¬èƒ½çœ‹åˆ°é»‘æ´å—ï¼Ÿ</div>
                            <div class="flip-back">2019å¹´ï¼Œç§‘å­¦å®¶ç¬¬ä¸€æ¬¡æ‹åˆ°äº†é»‘æ´çš„ç…§ç‰‡ï¼ä»–ä»¬ç”¨äº†<strong>å…¨ä¸–ç•Œ8å°æœ›è¿œé•œ</strong>ç»„æˆä¸€ä¸ª"åœ°çƒå¤§å°"çš„æœ›è¿œé•œæ‰åšåˆ°çš„ï¼</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="panel-toggle" id="panelToggle" onclick="togglePanel()">â—€</div>

    <!-- åº•éƒ¨å›¾ç‰‡åˆ‡æ¢ -->
    <div class="image-switcher">
        <button class="img-switch-btn active" data-img="1" onclick="switchImage('1')">é‡‘è‰²å¡å†ˆå›¾é›…</button>
        <button class="img-switch-btn" data-img="2" onclick="switchImage('2')">æ˜Ÿé™…ç©¿è¶Šç‰ˆ</button>
        <a class="img-switch-btn" href="blackhole-3d.html" style="text-decoration:none;">ğŸŒ€ 3D äº¤äº’ç‰ˆ</a>
    </div>

    <!-- ç¼©æ”¾æ§åˆ¶ -->
    <div class="zoom-controls">
        <button class="zoom-btn" onclick="zoomIn()" title="æ”¾å¤§">+</button>
        <div class="zoom-level" id="zoomLevel">1.0x</div>
        <button class="zoom-btn" onclick="zoomOut()" title="ç¼©å°">âˆ’</button>
        <button class="zoom-btn" onclick="zoomReset()" title="é‡ç½®" style="font-size:0.7rem;">â†º</button>
    </div>

    <!-- é¦–é¡µé“¾æ¥ -->
    <a class="home-link" href="../index.html">ğŸ  å­¦ä¹ ä¹å›­</a>

    <script>
    // ============ é…ç½® ============
    const IMAGES = {
        '1': { src: '1.jpeg', name: 'é‡‘è‰²å¡å†ˆå›¾é›…' },
        '2': { src: '2.png', name: 'æ˜Ÿé™…ç©¿è¶Šç‰ˆ' }
    };

    const ANNOTATIONS = [
        {
            id: 'singularity',
            name: 'å¥‡ç‚¹',
            desc: 'é»‘æ´æœ€ä¸­å¿ƒï¼Œæ‰€æœ‰è´¨é‡è¢«å‹ç¼©åˆ°æ— é™å°çš„ä¸€ä¸ªç‚¹',
            color: '#ffffff',
            // ç™¾åˆ†æ¯”åæ ‡ï¼ˆç›¸å¯¹å›¾ç‰‡å°ºå¯¸ï¼‰
            positions: {
                '1': { x: 50, y: 50 },
                '2': { x: 50, y: 50 }
            }
        },
        {
            id: 'event-horizon',
            name: 'äº‹ä»¶è§†ç•Œ',
            desc: '"ä¸å¯è¿”å›çº¿"â€”â€”è¶Šè¿‡å°±å›ä¸æ¥äº†',
            color: '#ff4444',
            positions: {
                '1': { x: 50, y: 35 },
                '2': { x: 50, y: 35 }
            }
        },
        {
            id: 'photon-ring',
            name: 'å…‰å­ç¯',
            desc: 'å…‰ç»•ç€é»‘æ´è½¬åœˆå½¢æˆçš„æ˜äº®å…‰ç¯',
            color: '#f4d03f',
            positions: {
                '1': { x: 35, y: 42 },
                '2': { x: 35, y: 42 }
            }
        },
        {
            id: 'accretion-disk',
            name: 'å¸ç§¯ç›˜',
            desc: 'è¢«å¸å…¥çš„ç‰©è´¨æ—‹è½¬å½¢æˆçš„è¶…é«˜æ¸©ç›˜',
            color: '#e67e22',
            positions: {
                '1': { x: 22, y: 52 },
                '2': { x: 22, y: 52 }
            }
        },
        {
            id: 'gravitational-lensing',
            name: 'å¼•åŠ›é€é•œ',
            desc: 'å¼¯æ›²çš„å…‰çº¿è®©æˆ‘ä»¬çœ‹åˆ°é»‘æ´èƒŒåçš„æ™¯è±¡',
            color: '#00d4ff',
            positions: {
                '1': { x: 68, y: 30 },
                '2': { x: 68, y: 30 }
            }
        }
    ];

    // ============ çŠ¶æ€ ============
    let currentImage = '1';
    let scale = 1;
    let translateX = 0;
    let translateY = 0;
    const MIN_SCALE = 0.5;
    const MAX_SCALE = 5;
    let isDragging = false;
    let lastX = 0, lastY = 0;
    let annotationsVisible = true;
    let image2Loaded = false;
    let imageNaturalW = 0, imageNaturalH = 0;

    // DOM
    const viewer = document.getElementById('viewer');
    const viewerContent = document.getElementById('viewerContent');
    const bhImage = document.getElementById('bhImage');
    const annotationsLayer = document.getElementById('annotationsLayer');
    const zoomLevelEl = document.getElementById('zoomLevel');
    const panel = document.getElementById('panel');
    const panelToggle = document.getElementById('panelToggle');
    const loading = document.getElementById('loading');

    // ============ åˆå§‹åŒ– ============
    function init() {
        createStars();
        createParticles();
        createAnnotations();
        setupEvents();

        bhImage.onload = function() {
            imageNaturalW = bhImage.naturalWidth;
            imageNaturalH = bhImage.naturalHeight;
            resetView();
            loading.classList.add('fade-out');
            setTimeout(() => loading.style.display = 'none', 600);
        };

        if (bhImage.complete && bhImage.naturalWidth > 0) {
            imageNaturalW = bhImage.naturalWidth;
            imageNaturalH = bhImage.naturalHeight;
            resetView();
            loading.classList.add('fade-out');
            setTimeout(() => loading.style.display = 'none', 600);
        }
    }

    // ============ æ˜Ÿç©º ============
    function createStars() {
        const container = document.getElementById('starsBg');
        for (let i = 0; i < 100; i++) {
            const s = document.createElement('div');
            s.className = 'star';
            const size = Math.random() * 2.5 + 0.5;
            s.style.cssText = `
                width:${size}px;height:${size}px;
                left:${Math.random()*100}%;top:${Math.random()*100}%;
                animation-delay:${Math.random()*3}s;
                animation-duration:${2+Math.random()*3}s;
            `;
            container.appendChild(s);
        }
    }

    // ============ å¸å…¥ç²’å­ ============
    function createParticles() {
        const container = document.getElementById('particles');
        const cx = window.innerWidth / 2;
        const cy = window.innerHeight / 2;

        for (let i = 0; i < 18; i++) {
            const p = document.createElement('div');
            p.className = 'particle';

            // éšæœºä»è¾¹ç¼˜å‡ºå‘
            const angle = Math.random() * Math.PI * 2;
            const dist = Math.max(window.innerWidth, window.innerHeight) * 0.6;
            const startX = cx + Math.cos(angle) * dist;
            const startY = cy + Math.sin(angle) * dist;
            const dx = cx - startX;
            const dy = cy - startY;

            const size = 1 + Math.random() * 3;
            const duration = 6 + Math.random() * 8;
            const colors = ['#f4d03f', '#e67e22', '#00d4ff', '#ff6b6b', '#fff'];
            const color = colors[Math.floor(Math.random() * colors.length)];

            p.style.cssText = `
                left:${startX}px;top:${startY}px;
                width:${size}px;height:${size}px;
                background:${color};
                --dx:${dx}px;--dy:${dy}px;
                animation-duration:${duration}s;
                animation-delay:${Math.random()*duration}s;
            `;
            container.appendChild(p);
        }
    }

    // ============ æ ‡æ³¨ ============
    function createAnnotations() {
        annotationsLayer.innerHTML = '';
        ANNOTATIONS.forEach(a => {
            const pos = a.positions[currentImage];
            const el = document.createElement('div');
            el.className = 'annotation';
            el.id = 'anno-' + a.id;
            el.style.left = pos.x + '%';
            el.style.top = pos.y + '%';
            el.style.transform = 'translate(-8px, -8px)';

            el.innerHTML = `
                <div class="anno-dot" style="background:${a.color};box-shadow:0 0 10px ${a.color}"></div>
                <div class="anno-line" style="background:${a.color}"></div>
                <div class="anno-label">
                    <div class="anno-title" style="color:${a.color}">${a.name}</div>
                    <div class="anno-desc">${a.desc}</div>
                </div>
            `;
            annotationsLayer.appendChild(el);
        });
    }

    function updateAnnotationPositions() {
        ANNOTATIONS.forEach(a => {
            const pos = a.positions[currentImage];
            const el = document.getElementById('anno-' + a.id);
            if (el) {
                el.style.left = pos.x + '%';
                el.style.top = pos.y + '%';
            }
        });
    }

    // ============ è§†å›¾æ§åˆ¶ ============
    function updateTransform() {
        viewerContent.style.transform =
            `translate(${translateX}px, ${translateY}px) scale(${scale})`;
        zoomLevelEl.textContent = scale.toFixed(1) + 'x';
    }

    function resetView() {
        scale = 1;
        const vw = window.innerWidth;
        const vh = window.innerHeight;
        // ç­‰å¾…å›¾ç‰‡æ¸²æŸ“å®Œæˆå†è·å–å°ºå¯¸
        requestAnimationFrame(() => {
            const imgW = bhImage.offsetWidth || bhImage.clientWidth;
            const imgH = bhImage.offsetHeight || bhImage.clientHeight;
            translateX = (vw - imgW) / 2;
            translateY = (vh - imgH) / 2;
            viewerContent.classList.add('smooth');
            updateTransform();
            setTimeout(() => viewerContent.classList.remove('smooth'), 300);
        });
    }

    function zoomToPoint(cx, cy, factor) {
        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, scale * factor));
        const ratio = newScale / scale;
        translateX = cx - (cx - translateX) * ratio;
        translateY = cy - (cy - translateY) * ratio;
        scale = newScale;
        updateTransform();
    }

    function zoomIn() {
        const cx = window.innerWidth / 2;
        const cy = window.innerHeight / 2;
        viewerContent.classList.add('smooth');
        zoomToPoint(cx, cy, 1.3);
        setTimeout(() => viewerContent.classList.remove('smooth'), 300);
    }

    function zoomOut() {
        const cx = window.innerWidth / 2;
        const cy = window.innerHeight / 2;
        viewerContent.classList.add('smooth');
        zoomToPoint(cx, cy, 1 / 1.3);
        setTimeout(() => viewerContent.classList.remove('smooth'), 300);
    }

    function zoomReset() {
        resetView();
    }

    // ============ äº‹ä»¶ç»‘å®š ============
    function setupEvents() {
        // é¼ æ ‡æ»šè½®ç¼©æ”¾
        viewer.addEventListener('wheel', e => {
            e.preventDefault();
            const factor = e.deltaY < 0 ? 1.1 : 1 / 1.1;
            zoomToPoint(e.clientX, e.clientY, factor);
        }, { passive: false });

        // é¼ æ ‡æ‹–æ‹½
        viewer.addEventListener('mousedown', e => {
            if (e.target.closest('.annotation')) return;
            isDragging = true;
            lastX = e.clientX;
            lastY = e.clientY;
            document.body.classList.add('grabbing');
            e.preventDefault();
        });

        window.addEventListener('mousemove', e => {
            if (!isDragging) return;
            const dx = e.clientX - lastX;
            const dy = e.clientY - lastY;
            translateX += dx;
            translateY += dy;
            lastX = e.clientX;
            lastY = e.clientY;
            updateTransform();
        });

        window.addEventListener('mouseup', () => {
            isDragging = false;
            document.body.classList.remove('grabbing');
        });

        // åŒå‡»åˆ‡æ¢ç¼©æ”¾
        let lastTapTime = 0;
        viewer.addEventListener('dblclick', e => {
            if (e.target.closest('.annotation')) return;
            viewerContent.classList.add('smooth');
            if (scale > 1.5) {
                resetView();
            } else {
                zoomToPoint(e.clientX, e.clientY, 2.5 / scale);
            }
            setTimeout(() => viewerContent.classList.remove('smooth'), 300);
        });

        // è§¦æ‘¸äº‹ä»¶
        let touches = [];
        let lastTouchDist = 0;
        let lastTouchCX = 0, lastTouchCY = 0;
        let touchStartTime = 0;
        let touchStartX = 0, touchStartY = 0;

        viewer.addEventListener('touchstart', e => {
            touches = Array.from(e.touches);
            if (touches.length === 1) {
                isDragging = true;
                lastX = touches[0].clientX;
                lastY = touches[0].clientY;
                touchStartTime = Date.now();
                touchStartX = lastX;
                touchStartY = lastY;
            } else if (touches.length === 2) {
                isDragging = false;
                const dx = touches[1].clientX - touches[0].clientX;
                const dy = touches[1].clientY - touches[0].clientY;
                lastTouchDist = Math.sqrt(dx * dx + dy * dy);
                lastTouchCX = (touches[0].clientX + touches[1].clientX) / 2;
                lastTouchCY = (touches[0].clientY + touches[1].clientY) / 2;
            }
            e.preventDefault();
        }, { passive: false });

        viewer.addEventListener('touchmove', e => {
            const cur = Array.from(e.touches);
            if (cur.length === 1 && isDragging) {
                const dx = cur[0].clientX - lastX;
                const dy = cur[0].clientY - lastY;
                translateX += dx;
                translateY += dy;
                lastX = cur[0].clientX;
                lastY = cur[0].clientY;
                updateTransform();
            } else if (cur.length === 2) {
                const dx = cur[1].clientX - cur[0].clientX;
                const dy = cur[1].clientY - cur[0].clientY;
                const dist = Math.sqrt(dx * dx + dy * dy);
                const cx = (cur[0].clientX + cur[1].clientX) / 2;
                const cy = (cur[0].clientY + cur[1].clientY) / 2;

                if (lastTouchDist > 0) {
                    const factor = dist / lastTouchDist;
                    zoomToPoint(cx, cy, factor);
                }

                // åŒæŒ‡å¹³ç§»
                translateX += cx - lastTouchCX;
                translateY += cy - lastTouchCY;
                updateTransform();

                lastTouchDist = dist;
                lastTouchCX = cx;
                lastTouchCY = cy;
            }
            e.preventDefault();
        }, { passive: false });

        viewer.addEventListener('touchend', e => {
            const cur = Array.from(e.touches);
            if (cur.length === 0) {
                // æ£€æµ‹åŒå‡»
                const elapsed = Date.now() - touchStartTime;
                const dist = Math.abs(e.changedTouches[0].clientX - touchStartX) +
                             Math.abs(e.changedTouches[0].clientY - touchStartY);
                if (elapsed < 300 && dist < 20) {
                    const now = Date.now();
                    if (now - lastTapTime < 400) {
                        // åŒå‡»
                        viewerContent.classList.add('smooth');
                        if (scale > 1.5) {
                            resetView();
                        } else {
                            zoomToPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY, 2.5 / scale);
                        }
                        setTimeout(() => viewerContent.classList.remove('smooth'), 300);
                        lastTapTime = 0;
                    } else {
                        lastTapTime = now;
                    }
                }
                isDragging = false;
            } else if (cur.length === 1) {
                isDragging = true;
                lastX = cur[0].clientX;
                lastY = cur[0].clientY;
                lastTouchDist = 0;
            }
        });

        // çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', () => {
            resetView();
        });

        // é”®ç›˜å¿«æ·é”®
        window.addEventListener('keydown', e => {
            if (e.key === '+' || e.key === '=') zoomIn();
            else if (e.key === '-') zoomOut();
            else if (e.key === '0') zoomReset();
        });
    }

    // ============ å›¾ç‰‡åˆ‡æ¢ ============
    function switchImage(id) {
        if (id === currentImage) return;
        currentImage = id;

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        document.querySelectorAll('.img-switch-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.img === id);
        });

        // æ¸å˜åˆ‡æ¢
        bhImage.style.opacity = '0';
        bhImage.style.transition = 'opacity 0.3s ease';

        setTimeout(() => {
            bhImage.src = IMAGES[id].src;
            bhImage.onload = function() {
                imageNaturalW = bhImage.naturalWidth;
                imageNaturalH = bhImage.naturalHeight;
                bhImage.style.opacity = '1';
                updateAnnotationPositions();
                resetView();
                // åˆ‡æ¢å›¾ç‰‡åé‡æ–°åˆ›å»º CSS ç²’å­ï¼ˆé¢œè‰²å’Œè½¨é“å‚æ•°ä¸åŒï¼‰
                setTimeout(createFxParticles, 100);
            };
        }, 300);
    }

    // ============ æ ‡æ³¨æ§åˆ¶ ============
    function toggleAnnotations() {
        annotationsVisible = !annotationsVisible;
        const btn = document.getElementById('toggleLabelsBtn');
        btn.classList.toggle('active', annotationsVisible);
        annotationsLayer.classList.toggle('annotations-hidden', !annotationsVisible);
    }

    function highlightAnno(id) {
        // æ¸…é™¤æ—§é«˜äº®
        document.querySelectorAll('.annotation.active').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.structure-card.active').forEach(el => el.classList.remove('active'));

        // é«˜äº®æ ‡æ³¨
        const annoEl = document.getElementById('anno-' + id);
        if (annoEl) {
            annoEl.classList.add('active');
            // ç¡®ä¿æ ‡æ³¨å¯è§
            if (!annotationsVisible) {
                toggleAnnotations();
            }
        }

        // é«˜äº®å¡ç‰‡
        const card = document.querySelector(`.structure-card[data-anno="${id}"]`);
        if (card) card.classList.add('active');

        // 3ç§’åæ¸…é™¤
        setTimeout(() => {
            if (annoEl) annoEl.classList.remove('active');
            if (card) card.classList.remove('active');
        }, 3000);
    }

    // ============ é¢æ¿æ§åˆ¶ ============
    function togglePanel() {
        panel.classList.toggle('collapsed');
        panelToggle.textContent = panel.classList.contains('collapsed') ? 'â–¶' : 'â—€';
    }

    function toggleSection(header) {
        const section = header.parentElement;
        section.classList.toggle('open');
    }

    // ============ å¸ç§¯ç›˜åŠ¨ç”»ï¼ˆçº¯ CSSï¼Œé›¶ Canvas/rAF å¼€é”€ï¼‰ ============
    const fxLayer = document.getElementById('fxLayer');

    const FX_CONFIG = {
        '1': {
            cx: 50, cy: 47,           // é»‘æ´ä¸­å¿ƒ (%)
            diskRx: 42, diskRy: 6,     // å¸ç§¯ç›˜æ¤­åœ†åŠå¾„ (%)
            arcRx: 30, arcRy: 32,      // å…‰å¼§æ¤­åœ†åŠå¾„ (%)
            colors: ['#f4d03f', '#e67e22', '#f39c12', '#ffcc00', '#ffd700'],
        },
        '2': {
            cx: 50, cy: 48,
            diskRx: 40, diskRy: 5,
            arcRx: 28, arcRy: 30,
            colors: ['#c0d8ff', '#89b4fa', '#ffffff', '#b4d0ff', '#d0e8ff'],
        }
    };

    function pickFxColor(cfg) {
        return cfg.colors[Math.floor(Math.random() * cfg.colors.length)];
    }

    function createFxParticles() {
        fxLayer.innerHTML = '';
        const cfg = FX_CONFIG[currentImage];

        // å¸ç§¯ç›˜è½¨é“ç²’å­ï¼ˆ30ä¸ªï¼‰
        for (let i = 0; i < 30; i++) {
            const rx = cfg.diskRx + (Math.random() - 0.5) * 8;
            const ry = cfg.diskRy + (Math.random() - 0.5) * 3;
            const dur = 12 + Math.random() * 18;
            const delay = -Math.random() * dur;
            const dotSize = 3 + Math.random() * 5;
            const opacity = 0.2 + Math.random() * 0.5;
            const color = pickFxColor(cfg);
            const angle = Math.random() * 360;
            // ç²’å­åœ¨è½¨é“ä¸Šçš„ä½ç½®ï¼ˆ0=é¡¶éƒ¨ï¼Œæ²¿åœ†å‘¨ï¼‰
            const dotAngle = Math.random() * 360;

            const ring = document.createElement('div');
            ring.className = 'orbit-ring';
            const squash = ry / rx;
            ring.style.cssText = `
                left:${cfg.cx}%;top:${cfg.cy}%;
                width:${rx * 2}%;height:${rx * 2}%;
                --dur:${dur}s;--delay:${delay}s;
                transform:translate(-50%,-50%) scaleY(${squash}) rotate(${angle}deg);
            `;

            const dot = document.createElement('div');
            dot.className = 'orbit-dot';
            const rad = dotAngle * Math.PI / 180;
            const dx = 50 + 50 * Math.cos(rad);
            const dy = 50 + 50 * Math.sin(rad);
            dot.style.cssText = `
                left:${dx}%;top:${dy}%;
                width:${dotSize}px;height:${dotSize}px;
                background:radial-gradient(circle,${color},transparent);
                opacity:${opacity};
                --counter-scale:${1/squash};
            `;
            ring.appendChild(dot);
            fxLayer.appendChild(ring);
        }

        // å…‰å¼§è½¨é“ç²’å­ï¼ˆ15ä¸ªï¼‰
        for (let i = 0; i < 15; i++) {
            const rx = cfg.arcRx + (Math.random() - 0.5) * 6;
            const ry = cfg.arcRy + (Math.random() - 0.5) * 6;
            const dur = 18 + Math.random() * 24;
            const delay = -Math.random() * dur;
            const dotSize = 2 + Math.random() * 4;
            const opacity = 0.1 + Math.random() * 0.3;
            const color = pickFxColor(cfg);
            const angle = Math.random() * 360;
            const dotAngle = Math.random() * 360;

            const ring = document.createElement('div');
            ring.className = 'orbit-ring';
            const squash = ry / rx;
            ring.style.cssText = `
                left:${cfg.cx}%;top:${cfg.cy}%;
                width:${rx * 2}%;height:${rx * 2}%;
                --dur:${dur}s;--delay:${delay}s;
                transform:translate(-50%,-50%) scaleY(${squash}) rotate(${angle}deg);
            `;

            const dot = document.createElement('div');
            dot.className = 'orbit-dot';
            const rad = dotAngle * Math.PI / 180;
            const dx = 50 + 50 * Math.cos(rad);
            const dy = 50 + 50 * Math.sin(rad);
            dot.style.cssText = `
                left:${dx}%;top:${dy}%;
                width:${dotSize}px;height:${dotSize}px;
                background:radial-gradient(circle,${color},transparent);
                opacity:${opacity};
                --counter-scale:${1/squash};
            `;
            ring.appendChild(dot);
            fxLayer.appendChild(ring);
        }

        // é—ªçƒç²’å­ï¼ˆ20ä¸ªï¼Œæ•£å¸ƒåœ¨å¸ç§¯ç›˜é™„è¿‘ï¼‰
        for (let i = 0; i < 20; i++) {
            const x = cfg.cx + (Math.random() - 0.5) * cfg.diskRx * 1.8;
            const y = cfg.cy + (Math.random() - 0.5) * 12;
            const size = 2 + Math.random() * 4;
            const color = pickFxColor(cfg);
            const dur = 2 + Math.random() * 4;
            const delay = Math.random() * dur;
            const maxOpacity = 0.15 + Math.random() * 0.4;

            const dot = document.createElement('div');
            dot.className = 'glow-dot';
            dot.style.cssText = `
                left:${x}%;top:${y}%;
                width:${size}px;height:${size}px;
                background:radial-gradient(circle,${color},transparent);
                --glow-dur:${dur}s;--glow-delay:${delay}s;--glow-max:${maxOpacity};
            `;
            fxLayer.appendChild(dot);
        }
    }

    // ============ å¯åŠ¨ ============
    init();

    // å›¾ç‰‡å°±ç»ªååˆ›å»º CSS ç²’å­
    if (bhImage.complete && bhImage.naturalWidth > 0) {
        setTimeout(createFxParticles, 100);
    } else {
        bhImage.addEventListener('load', () => setTimeout(createFxParticles, 100));
    }
    </script>
</body>
</html>
