<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ªç©ºèµ›è·‘ - è°èƒ½æœ€å¿«åˆ°è¾¾å¤ªé˜³ï¼Ÿ</title>
    <link rel="preconnect" href="https://fonts.loli.net">
    <link href="https://fonts.loli.net/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0a0a2a 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .star { position: absolute; border-radius: 50%; background: #fff; animation: twinkle 3s infinite alternate; }
        @keyframes twinkle { 0% { opacity: 0.3; } 100% { opacity: 1; } }

        .container {
            position: relative; z-index: 1;
            max-width: 820px; margin: 0 auto;
            padding: 20px 16px 60px;
        }

        /* ============ Header ============ */
        .header { text-align: center; margin-bottom: 20px; position: relative; }
        .back-btn {
            position: absolute; left: 0; top: 4px;
            color: rgba(255,255,255,0.5); text-decoration: none; font-size: 0.9rem;
            transition: color 0.2s;
        }
        .back-btn:hover { color: #fff; }
        .header h1 {
            font-size: 1.8rem; font-weight: 900;
            background: linear-gradient(135deg, #ff9800, #ffd54f);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .subtitle { color: rgba(255,255,255,0.5); font-size: 0.95rem; margin-top: 4px; }

        /* ============ Distance Scale ============ */
        .scale {
            display: flex; align-items: center; justify-content: center;
            margin: 20px 0; padding: 16px; gap: 8px;
            background: rgba(255,255,255,0.03); border-radius: 12px;
        }
        .scale-icon { font-size: 2rem; line-height: 1; }
        .scale-label { font-size: 0.75rem; color: rgba(255,255,255,0.5); text-align: center; }
        .scale-line {
            flex: 1; max-width: 320px; text-align: center; position: relative;
            border-top: 2px dashed rgba(255,255,255,0.2); margin-top: -4px; padding-top: 10px;
        }
        .scale-dist { font-size: 0.9rem; color: rgba(255,255,255,0.7); font-weight: 700; }

        /* ============ Intro ============ */
        .intro {
            text-align: center; font-size: 0.9rem; color: rgba(255,255,255,0.6);
            margin-bottom: 20px; line-height: 1.7;
        }

        /* ============ Tracks ============ */
        .tracks { display: flex; flex-direction: column; gap: 6px; margin-bottom: 20px; }
        .track {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px; padding: 10px 14px;
            cursor: pointer; transition: all 0.3s ease;
        }
        .track:hover { background: rgba(255,255,255,0.07); border-color: rgba(255,255,255,0.15); }
        .track.arrived { border-color: #ffd54f; box-shadow: 0 0 12px rgba(255,213,77,0.2); }

        .track-main { display: flex; align-items: center; gap: 10px; }
        .track-info { display: flex; align-items: center; gap: 8px; min-width: 110px; flex-shrink: 0; }
        .track-icon { font-size: 1.4rem; width: 28px; text-align: center; }
        .track-name { font-weight: 700; font-size: 0.9rem; white-space: nowrap; }
        .track-speed { font-size: 0.7rem; color: rgba(255,255,255,0.35); }

        .track-bar-wrap {
            flex: 1; height: 22px; min-width: 80px;
            background: rgba(255,255,255,0.06); border-radius: 11px;
            position: relative; overflow: hidden;
        }
        .track-bar-fill {
            height: 100%; width: 0%; border-radius: 11px;
            position: relative; min-width: 0;
        }
        .track-bar-fill.animate { transition: width 0.15s linear; }

        .track-status { min-width: 90px; text-align: right; font-size: 0.82rem; color: rgba(255,255,255,0.6); flex-shrink: 0; }
        .track-status.done { color: #ffd54f; font-weight: 700; }

        /* ============ Arrival Banner ============ */
        .arrival-banner {
            max-height: 0; overflow: hidden; opacity: 0;
            transition: max-height 0.4s ease, opacity 0.4s ease, margin 0.3s ease;
            font-size: 0.85rem; color: #ffd54f; padding-left: 46px;
        }
        .arrival-banner.show { max-height: 40px; opacity: 1; margin-top: 6px; }

        /* ============ Journey Card ============ */
        .journey-card {
            max-height: 0; overflow: hidden;
            transition: max-height 0.5s ease, margin 0.3s ease;
        }
        .journey-card.expanded { max-height: 500px; margin-top: 10px; }

        .journey-inner {
            background: rgba(255,255,255,0.05); border-radius: 10px; padding: 14px 16px;
        }
        .journey-title { font-size: 0.95rem; font-weight: 700; margin-bottom: 12px; }

        .milestone {
            display: flex; gap: 10px; padding: 7px 0 7px 14px;
            border-left: 2px solid var(--tc); margin-left: 5px; position: relative;
        }
        .milestone::before {
            content: ''; position: absolute; left: -6px; top: 11px;
            width: 10px; height: 10px; border-radius: 50%; background: var(--tc);
        }
        .milestone:last-of-type { border-left-color: transparent; }
        .milestone-time { font-weight: 700; min-width: 85px; font-size: 0.85rem; flex-shrink: 0; }
        .milestone-body { flex: 1; }
        .milestone-label { font-size: 0.85rem; color: rgba(255,255,255,0.8); }
        .milestone-fun { font-size: 0.78rem; color: rgba(255,255,255,0.4); margin-top: 2px; }

        .journey-fact {
            margin-top: 10px; padding: 8px 12px;
            background: rgba(255,215,77,0.08); border-radius: 8px;
            font-size: 0.85rem; color: #ffd54f;
        }

        /* ============ Controls ============ */
        .controls {
            background: rgba(255,255,255,0.04); border-radius: 12px;
            padding: 14px 16px; margin-bottom: 18px;
        }
        .timer-row { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 10px; }
        .timer-label { color: rgba(255,255,255,0.5); font-size: 0.9rem; }
        .timer-value { font-size: 1.15rem; font-weight: 700; color: #ffd54f; min-width: 100px; }

        .speed-row { display: flex; align-items: center; justify-content: center; gap: 8px; flex-wrap: wrap; }
        .speed-label { font-size: 0.8rem; color: rgba(255,255,255,0.4); }
        .speed-btn {
            padding: 5px 12px; border-radius: 18px;
            border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.7); font-size: 0.82rem; cursor: pointer; transition: all 0.2s;
            font-family: inherit;
        }
        .speed-btn:hover { background: rgba(255,255,255,0.1); }
        .speed-btn.active { background: rgba(255,152,0,0.2); border-color: #ff9800; color: #ff9800; }
        .speed-hint { width: 100%; text-align: center; font-size: 0.75rem; color: rgba(255,255,255,0.3); margin-top: 6px; }

        /* ============ Action Buttons ============ */
        .action-area { display: flex; justify-content: center; gap: 12px; margin-bottom: 20px; }
        .btn-primary {
            padding: 12px 36px; font-size: 1.2rem; font-weight: 700;
            border: none; border-radius: 28px;
            background: linear-gradient(135deg, #ff9800, #ff5722);
            color: #fff; cursor: pointer; transition: all 0.3s; font-family: inherit;
        }
        .btn-primary:hover { transform: scale(1.05); box-shadow: 0 8px 25px rgba(255,152,0,0.3); }
        .btn-secondary {
            padding: 10px 22px; font-size: 0.95rem; font-weight: 700;
            border: 1px solid rgba(255,255,255,0.2); border-radius: 22px;
            background: rgba(255,255,255,0.06); color: #fff;
            cursor: pointer; transition: all 0.2s; font-family: inherit;
        }
        .btn-secondary:hover { background: rgba(255,255,255,0.12); }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255,152,0,0.4); }
            70% { box-shadow: 0 0 0 14px rgba(255,152,0,0); }
            100% { box-shadow: 0 0 0 0 rgba(255,152,0,0); }
        }
        .pulse { animation: pulse 2s infinite; }

        /* ============ Finish ============ */
        .finish { display: none; text-align: center; padding: 20px; background: rgba(255,215,77,0.08); border: 1px solid rgba(255,215,77,0.2); border-radius: 14px; margin-top: 10px; }
        .finish.show { display: block; }
        .finish-title { font-size: 1.3rem; font-weight: 900; margin-bottom: 8px; }
        .finish-ranks { text-align: left; display: inline-block; font-size: 0.9rem; line-height: 1.8; }
        .finish-footer { margin-top: 12px; font-size: 0.85rem; color: rgba(255,255,255,0.6); }

        /* ============ Responsive ============ */
        @media (max-width: 600px) {
            .header h1 { font-size: 1.4rem; }
            .track-info { min-width: 90px; }
            .track-bar-wrap { height: 18px; }
            .track-status { min-width: 70px; font-size: 0.78rem; }
            .speed-btn { padding: 4px 10px; font-size: 0.78rem; }
            .btn-primary { padding: 10px 28px; font-size: 1.1rem; }
            .milestone-time { min-width: 70px; font-size: 0.8rem; }
            .arrival-banner { padding-left: 38px; font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="container">
        <header class="header">
            <a href="../index.html" class="back-btn">â† è¿”å›ä¹å›­</a>
            <h1>â˜€ï¸ å¤ªç©ºèµ›è·‘</h1>
            <p class="subtitle">è°èƒ½æœ€å¿«åˆ°è¾¾å¤ªé˜³ï¼Ÿ</p>
        </header>

        <div class="scale">
            <div>
                <div class="scale-icon">ğŸŒ</div>
                <div class="scale-label">åœ°çƒ</div>
            </div>
            <div class="scale-line">
                <div class="scale-dist">1.5 äº¿å…¬é‡Œ</div>
            </div>
            <div>
                <div class="scale-icon">â˜€ï¸</div>
                <div class="scale-label">å¤ªé˜³</div>
            </div>
        </div>

        <p class="intro">åœ°çƒåˆ°å¤ªé˜³æœ‰ 1 äº¿ 5 åƒä¸‡å…¬é‡Œè¿œï¼<br>åä¸åŒçš„äº¤é€šå·¥å…·å‡ºå‘ï¼Œè¦å¤šä¹…æ‰èƒ½åˆ°å‘¢ï¼Ÿç‚¹å‡»èµ›é“æŸ¥çœ‹æ—…ç¨‹æ•…äº‹ï¼</p>

        <div id="tracks" class="tracks"></div>

        <div class="controls" id="controls">
            <div class="timer-row">
                <span class="timer-label">â±ï¸ å·²è¿‡å»</span>
                <span class="timer-value" id="timer">0 ç§’</span>
            </div>
            <div class="speed-row">
                <span class="speed-label">å€ç‡</span>
                <button class="speed-btn" data-speed="10000">1ä¸‡x</button>
                <button class="speed-btn" data-speed="1000000">100ä¸‡x</button>
                <button class="speed-btn active" data-speed="100000000">1äº¿x</button>
                <button class="speed-btn" data-speed="1000000000">10äº¿x</button>
                <div class="speed-hint" id="speedHint">1ç§’ â‰ˆ 3.2å¹´ï¼Œé€‚åˆè§‚çœ‹é£æœºã€é«˜é“ã€æ±½è½¦</div>
            </div>
        </div>

        <div class="action-area" id="actionArea">
            <button class="btn-primary pulse" id="startBtn">ğŸ å‡ºå‘ï¼</button>
        </div>

        <div class="finish" id="finish">
            <div class="finish-title">ğŸ‰ æ¯”èµ›ç»“æŸï¼</div>
            <div class="finish-ranks" id="finishRanks"></div>
            <div class="finish-footer" id="finishFooter"></div>
        </div>
    </div>

<script>
// ============ æ•°æ® ============
const SUN_DISTANCE = 150_000_000;

const VEHICLES = [
    {
        id: 'walk', icon: 'ğŸš¶', name: 'æ­¥è¡Œ',
        speedKmH: 5, speedDisplay: '5 km/h', color: '#9e9e9e',
        arrivalMsg: '3,424å¹´ â€” ä»å¤§ç¦¹æ²»æ°´èµ°åˆ°ä»Šå¤©ï¼',
        funFact: 'äººç±»æ–‡æ˜çš„å†å²éƒ½ä¸å¤Ÿèµ°å®Œè¿™æ®µè·¯ï¼',
        milestones: [
            { label: 'åŒ—äº¬â†’ä¸Šæµ·', dist: '1,200å…¬é‡Œ', time: '10å¤©', fun: 'æ¯å¤©èµ°8å°æ—¶ï¼Œè¦èµ°10å¤©' },
            { label: 'ç»•åœ°çƒä¸€åœˆ', dist: '4ä¸‡å…¬é‡Œ', time: '11ä¸ªæœˆ', fun: 'èµ°äº†å°†è¿‘ä¸€æ•´å¹´' },
            { label: 'åˆ°è¾¾æœˆçƒ ğŸŒ™', dist: '38ä¸‡å…¬é‡Œ', time: 'è¿‘9å¹´', fun: 'æ™ºå¤©ä»å‡ºç”Ÿèµ°åˆ°ä¸Šå°å­¦' },
            { label: 'åˆ°è¾¾ç«æ˜Ÿ ğŸ”´', dist: '5,500ä¸‡å…¬é‡Œ', time: '1,256å¹´', fun: 'ä»å”æœèµ°åˆ°ç°åœ¨' },
            { label: 'åˆ°è¾¾å¤ªé˜³ â˜€ï¸', dist: '1.5äº¿å…¬é‡Œ', time: '3,424å¹´', fun: 'ä»å¤§ç¦¹æ²»æ°´èµ°åˆ°ä»Šå¤©' },
        ]
    },
    {
        id: 'ebike', icon: 'ğŸ›µ', name: 'ç”µåŠ¨è½¦',
        speedKmH: 25, speedDisplay: '25 km/h', color: '#66bb6a',
        arrivalMsg: '685å¹´ â€” ä»å…ƒæœéª‘åˆ°ç°åœ¨ï¼',
        funFact: '685å¹´å‰æ˜¯å…ƒæœï¼Œé‚£æ—¶å€™è¿˜æ²¡æœ‰ç”µåŠ¨è½¦å‘¢ï¼',
        milestones: [
            { label: 'åŒ—äº¬â†’ä¸Šæµ·', dist: '1,200å…¬é‡Œ', time: '2å¤©', fun: 'éª‘ä¸¤å¤©ä¸¤å¤œ' },
            { label: 'ç»•åœ°çƒä¸€åœˆ', dist: '4ä¸‡å…¬é‡Œ', time: '67å¤©', fun: 'ä¸¤ä¸ªå¤šæœˆ' },
            { label: 'åˆ°è¾¾æœˆçƒ ğŸŒ™', dist: '38ä¸‡å…¬é‡Œ', time: '1å¹´9ä¸ªæœˆ', fun: 'å·®ä¸å¤šä¸¤å¹´' },
            { label: 'åˆ°è¾¾ç«æ˜Ÿ ğŸ”´', dist: '5,500ä¸‡å…¬é‡Œ', time: '251å¹´', fun: 'ä»æ¸…æœéª‘åˆ°ç°åœ¨' },
            { label: 'åˆ°è¾¾å¤ªé˜³ â˜€ï¸', dist: '1.5äº¿å…¬é‡Œ', time: '685å¹´', fun: 'ä»å…ƒæœéª‘åˆ°ç°åœ¨' },
        ]
    },
    {
        id: 'car', icon: 'ğŸš—', name: 'å°æ±½è½¦',
        speedKmH: 120, speedDisplay: '120 km/h', color: '#42a5f5',
        arrivalMsg: '143å¹´ â€” çˆ·çˆ·å¼€åˆ°å­™å­æ¥ç€å¼€ï¼',
        funFact: 'ä¸€å®¶ä¸‰ä»£äººæ¥åŠ›å¼€è½¦éƒ½åˆ°ä¸äº†å¤ªé˜³ï¼',
        milestones: [
            { label: 'åŒ—äº¬â†’ä¸Šæµ·', dist: '1,200å…¬é‡Œ', time: '10å°æ—¶', fun: 'æ—©ä¸Šå‡ºå‘ï¼Œæ™šä¸Šåˆ°' },
            { label: 'ç»•åœ°çƒä¸€åœˆ', dist: '4ä¸‡å…¬é‡Œ', time: '14å¤©', fun: 'ä¸¤ä¸ªæ˜ŸæœŸä¸åœè½¦' },
            { label: 'åˆ°è¾¾æœˆçƒ ğŸŒ™', dist: '38ä¸‡å…¬é‡Œ', time: '4ä¸ªåŠæœˆ', fun: 'å¿«ä¸€ä¸ªå­¦æœŸäº†' },
            { label: 'åˆ°è¾¾ç«æ˜Ÿ ğŸ”´', dist: '5,500ä¸‡å…¬é‡Œ', time: '52å¹´', fun: 'æ™ºå¤©å¼€åˆ°å˜è€çˆ·çˆ·' },
            { label: 'åˆ°è¾¾å¤ªé˜³ â˜€ï¸', dist: '1.5äº¿å…¬é‡Œ', time: '143å¹´', fun: 'çˆ·çˆ·ä¼ çˆ¸çˆ¸ï¼Œçˆ¸çˆ¸ä¼ å„¿å­' },
        ]
    },
    {
        id: 'train', icon: 'ğŸš„', name: 'é«˜é“',
        speedKmH: 350, speedDisplay: '350 km/h', color: '#ab47bc',
        arrivalMsg: '49å¹´ â€” æ™ºå¤©ååˆ°å¤´å‘ç™½äº†ï¼',
        funFact: 'ä»å°å®å®ååˆ°è€çˆ·çˆ·ï¼',
        milestones: [
            { label: 'åŒ—äº¬â†’ä¸Šæµ·', dist: '1,200å…¬é‡Œ', time: '3.5å°æ—¶', fun: 'çœ‹ä¸€éƒ¨åŠ¨ç”»ç‰‡ç”µå½±' },
            { label: 'ç»•åœ°çƒä¸€åœˆ', dist: '4ä¸‡å…¬é‡Œ', time: '5å¤©', fun: 'ä¸åˆ°ä¸€ä¸ªæ˜ŸæœŸ' },
            { label: 'åˆ°è¾¾æœˆçƒ ğŸŒ™', dist: '38ä¸‡å…¬é‡Œ', time: '46å¤©', fun: 'ä¸€ä¸ªåŠæœˆ' },
            { label: 'åˆ°è¾¾ç«æ˜Ÿ ğŸ”´', dist: '5,500ä¸‡å…¬é‡Œ', time: '18å¹´', fun: 'æ™ºå¤©ååˆ°ä¸Šå¤§å­¦' },
            { label: 'åˆ°è¾¾å¤ªé˜³ â˜€ï¸', dist: '1.5äº¿å…¬é‡Œ', time: '49å¹´', fun: 'æ™ºå¤©ååˆ°å¤´å‘å˜ç™½' },
        ]
    },
    {
        id: 'plane', icon: 'âœˆï¸', name: 'é£æœº',
        speedKmH: 900, speedDisplay: '900 km/h', color: '#26c6da',
        arrivalMsg: '19å¹´ â€” ä»å°å®å®é£åˆ°å¤§å­¦æ¯•ä¸šè¿˜æ²¡åˆ°ï¼',
        funFact: 'åé£æœºå»å¤ªé˜³ï¼Ÿä»å‡ºç”Ÿåˆ°å¤§å­¦æ¯•ä¸šéƒ½ä¸å¤Ÿï¼',
        milestones: [
            { label: 'åŒ—äº¬â†’ä¸Šæµ·', dist: '1,200å…¬é‡Œ', time: '1å°æ—¶20åˆ†', fun: 'çœ‹ä¸¤é›†åŠ¨ç”»ç‰‡' },
            { label: 'ç»•åœ°çƒä¸€åœˆ', dist: '4ä¸‡å…¬é‡Œ', time: '44å°æ—¶', fun: 'å·®ä¸å¤šä¸¤å¤©' },
            { label: 'åˆ°è¾¾æœˆçƒ ğŸŒ™', dist: '38ä¸‡å…¬é‡Œ', time: '18å¤©', fun: 'ä¸åˆ°ä¸‰ä¸ªæ˜ŸæœŸ' },
            { label: 'åˆ°è¾¾ç«æ˜Ÿ ğŸ”´', dist: '5,500ä¸‡å…¬é‡Œ', time: '7å¹´', fun: 'æ™ºå¤©é£åˆ°ä¸Šå°å­¦' },
            { label: 'åˆ°è¾¾å¤ªé˜³ â˜€ï¸', dist: '1.5äº¿å…¬é‡Œ', time: '19å¹´', fun: 'æ™ºå¤©é£åˆ°å¤§å­¦æ¯•ä¸šè¿˜æ²¡åˆ°' },
        ]
    },
    {
        id: 'rocket', icon: 'ğŸš€', name: 'ç«ç®­',
        speedKmH: 40000, speedDisplay: '4ä¸‡ km/h', color: '#ff7043',
        arrivalMsg: '5ä¸ªæœˆ â€” å·®ä¸å¤šä¸€ä¸ªå­¦æœŸï¼',
        funFact: 'ç«ç®­å·²ç»å¾ˆå¿«äº†ï¼Œä½†åˆ°å¤ªé˜³è¿˜è¦åŠå¹´ï¼',
        milestones: [
            { label: 'åŒ—äº¬â†’ä¸Šæµ·', dist: '1,200å…¬é‡Œ', time: 'ä¸åˆ°2åˆ†é’Ÿ', fun: 'çœ¨å‡ ä¸‹çœ¼' },
            { label: 'ç»•åœ°çƒä¸€åœˆ', dist: '4ä¸‡å…¬é‡Œ', time: '1å°æ—¶', fun: 'ä¸€èŠ‚è¯¾çš„æ—¶é—´' },
            { label: 'åˆ°è¾¾æœˆçƒ ğŸŒ™', dist: '38ä¸‡å…¬é‡Œ', time: 'ä¸åˆ°10å°æ—¶', fun: 'ç¡ä¸€è§‰å°±åˆ°äº†' },
            { label: 'åˆ°è¾¾ç«æ˜Ÿ ğŸ”´', dist: '5,500ä¸‡å…¬é‡Œ', time: '57å¤©', fun: 'å·®ä¸å¤šä¸¤ä¸ªæœˆ' },
            { label: 'åˆ°è¾¾å¤ªé˜³ â˜€ï¸', dist: '1.5äº¿å…¬é‡Œ', time: '5ä¸ªæœˆ', fun: 'å·®ä¸å¤šä¸€ä¸ªå­¦æœŸ' },
        ]
    },
    {
        id: 'light', icon: 'âš¡', name: 'å…‰',
        speedKmH: 1_080_000_000, speedDisplay: '30ä¸‡ km/s', color: '#ffd54f',
        arrivalMsg: '8åˆ†20ç§’ â€” åƒåŠä¸ªè‹¹æœçš„æ—¶é—´ï¼',
        funFact: 'å…‰æ˜¯å®‡å®™ä¸­æœ€å¿«çš„ï¼ä½†åˆ°å¤ªé˜³ä¹Ÿè¦8åˆ†å¤šé’Ÿå‘¢ï¼',
        milestones: [
            { label: 'åŒ—äº¬â†’ä¸Šæµ·', dist: '1,200å…¬é‡Œ', time: '0.004ç§’', fun: 'æ¯”çœ¨çœ¼å¿«ä¸€åƒå€' },
            { label: 'ç»•åœ°çƒä¸€åœˆ', dist: '4ä¸‡å…¬é‡Œ', time: '0.13ç§’', fun: 'ä¸€çœ¨çœ¼å°±ç»•äº†åœ°çƒ' },
            { label: 'åˆ°è¾¾æœˆçƒ ğŸŒ™', dist: '38ä¸‡å…¬é‡Œ', time: '1.3ç§’', fun: 'è¯´ä¸€ä¸ªå­—çš„æ—¶é—´' },
            { label: 'åˆ°è¾¾ç«æ˜Ÿ ğŸ”´', dist: '5,500ä¸‡å…¬é‡Œ', time: '3åˆ†é’Ÿ', fun: 'åˆ·ä¸€æ¬¡ç‰™çš„æ—¶é—´' },
            { label: 'åˆ°è¾¾å¤ªé˜³ â˜€ï¸', dist: '1.5äº¿å…¬é‡Œ', time: '8åˆ†20ç§’', fun: 'åƒåŠä¸ªè‹¹æœçš„æ—¶é—´' },
        ]
    },
];

const SPEED_HINTS = {
    10000: '1ç§’ â‰ˆ 2.8å°æ—¶ï¼Œé€‚åˆè§‚çœ‹ âš¡å…‰',
    1000000: '1ç§’ â‰ˆ 11.6å¤©ï¼Œé€‚åˆè§‚çœ‹ ğŸš€ç«ç®­',
    100000000: '1ç§’ â‰ˆ 3.2å¹´ï¼Œé€‚åˆè§‚çœ‹ âœˆï¸ğŸš„ğŸš—',
    1000000000: '1ç§’ â‰ˆ 31.7å¹´ï¼Œæ‰€æœ‰äº¤é€šå·¥å…·å¯è§',
};

// ============ çŠ¶æ€ ============
let raceState = 'idle'; // idle | running | paused | finished
let simSeconds = 0;
let speedMul = 100_000_000;
let lastTs = null;
let rankCounter = 0;
let expandedCard = null;
const vStates = {};

// ============ DOM å¼•ç”¨ ============
const tracksEl = document.getElementById('tracks');
const timerEl = document.getElementById('timer');
const actionArea = document.getElementById('actionArea');
const finishEl = document.getElementById('finish');
const speedHintEl = document.getElementById('speedHint');

// ============ åˆå§‹åŒ– ============
function init() {
    VEHICLES.forEach(v => {
        vStates[v.id] = { arrived: false, rank: 0 };
        buildTrack(v);
    });
    setupSpeedBtns();
    document.getElementById('startBtn').addEventListener('click', startRace);
    createStars();
}

function buildTrack(v) {
    const el = document.createElement('div');
    el.className = 'track';
    el.dataset.id = v.id;
    el.style.setProperty('--tc', v.color);

    const totalTime = formatTime(SUN_DISTANCE / v.speedKmH * 3600);

    el.innerHTML = `
        <div class="track-main">
            <div class="track-info">
                <span class="track-icon">${v.icon}</span>
                <div>
                    <div class="track-name">${v.name}</div>
                    <div class="track-speed">${v.speedDisplay}</div>
                </div>
            </div>
            <div class="track-bar-wrap">
                <div class="track-bar-fill" data-fill style="background:${v.color};width:0%"></div>
            </div>
            <div class="track-status" data-status>${totalTime}</div>
        </div>
        <div class="arrival-banner" data-banner>${v.arrivalMsg}</div>
        <div class="journey-card" data-card>
            <div class="journey-inner">
                <div class="journey-title">${v.icon} ${v.name}çš„å¤ªé˜³ä¹‹æ—…ï¼ˆ${v.speedDisplay}ï¼‰</div>
                ${v.milestones.map(m => `
                    <div class="milestone">
                        <div class="milestone-time">${m.time}</div>
                        <div class="milestone-body">
                            <div class="milestone-label">ğŸ“ ${m.label}ï¼ˆ${m.dist}ï¼‰</div>
                            <div class="milestone-fun">${m.fun}</div>
                        </div>
                    </div>
                `).join('')}
                <div class="journey-fact">ğŸ’¡ ${v.funFact}</div>
            </div>
        </div>
    `;

    el.addEventListener('click', (e) => {
        if (e.target.closest('.speed-btn') || e.target.closest('.btn-primary') || e.target.closest('.btn-secondary')) return;
        toggleCard(v.id, el);
    });

    tracksEl.appendChild(el);
    vStates[v.id].el = el;
}

function toggleCard(id, el) {
    const card = el.querySelector('[data-card]');
    if (expandedCard === id) {
        card.classList.remove('expanded');
        expandedCard = null;
    } else {
        if (expandedCard) {
            const prev = document.querySelector(`.track[data-id="${expandedCard}"] [data-card]`);
            if (prev) prev.classList.remove('expanded');
        }
        card.classList.add('expanded');
        expandedCard = id;
    }
}

// ============ é€Ÿåº¦æŒ‰é’® ============
function setupSpeedBtns() {
    document.querySelectorAll('.speed-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            speedMul = parseInt(btn.dataset.speed);
            speedHintEl.textContent = SPEED_HINTS[speedMul] || '';
        });
    });
}

// ============ æ¯”èµ›æ§åˆ¶ ============
function startRace() {
    raceState = 'running';
    lastTs = null;
    // å¯åŠ¨æ—¶ç»™è¿›åº¦æ¡åŠ è¿‡æ¸¡
    document.querySelectorAll('[data-fill]').forEach(f => f.classList.add('animate'));
    showRunningBtns();
    requestAnimationFrame(animate);
}

function pauseRace() {
    raceState = 'paused';
    showPausedBtns();
}

function resumeRace() {
    raceState = 'running';
    lastTs = null;
    showRunningBtns();
    requestAnimationFrame(animate);
}

function resetRace() {
    raceState = 'idle';
    simSeconds = 0;
    lastTs = null;
    rankCounter = 0;

    VEHICLES.forEach(v => {
        const s = vStates[v.id];
        s.arrived = false;
        s.rank = 0;
        const el = s.el;
        el.classList.remove('arrived');
        el.querySelector('[data-fill]').style.width = '0%';
        el.querySelector('[data-fill]').classList.remove('animate');
        el.querySelector('[data-status]').textContent = formatTime(SUN_DISTANCE / v.speedKmH * 3600);
        el.querySelector('[data-status]').classList.remove('done');
        el.querySelector('[data-banner]').classList.remove('show');
    });

    timerEl.textContent = '0 ç§’';
    finishEl.classList.remove('show');
    showIdleBtns();
}

// ============ æŒ‰é’®åˆ‡æ¢ ============
function showIdleBtns() {
    actionArea.innerHTML = '<button class="btn-primary pulse" onclick="startRace()">ğŸ å‡ºå‘ï¼</button>';
}
function showRunningBtns() {
    actionArea.innerHTML = `
        <button class="btn-secondary" onclick="pauseRace()">â¸ï¸ æš‚åœ</button>
        <button class="btn-secondary" onclick="resetRace()">ğŸ”„ é‡æ¥</button>
    `;
}
function showPausedBtns() {
    actionArea.innerHTML = `
        <button class="btn-secondary" onclick="resumeRace()">â–¶ï¸ ç»§ç»­</button>
        <button class="btn-secondary" onclick="resetRace()">ğŸ”„ é‡æ¥</button>
    `;
}
function showFinishedBtns() {
    actionArea.innerHTML = '<button class="btn-primary" onclick="resetRace()">ğŸ”„ å†æ¥ä¸€æ¬¡ï¼</button>';
}

// ============ åŠ¨ç”»å¼•æ“ ============
function animate(ts) {
    if (raceState !== 'running') return;
    if (lastTs === null) lastTs = ts;

    const dt = Math.min(ts - lastTs, 100); // cap at 100ms
    lastTs = ts;
    simSeconds += (dt / 1000) * speedMul;

    let allDone = true;

    VEHICLES.forEach(v => {
        const s = vStates[v.id];
        if (s.arrived) return;

        const dist = v.speedKmH * (simSeconds / 3600);
        const progress = Math.min(1, dist / SUN_DISTANCE);

        s.el.querySelector('[data-fill]').style.width = (progress * 100) + '%';

        if (progress >= 1) {
            s.arrived = true;
            rankCounter++;
            s.rank = rankCounter;
            onArrived(v, s);
        } else {
            allDone = false;
        }
    });

    // ç¡®è®¤æ˜¯å¦å…¨éƒ¨åˆ°è¾¾
    if (allDone) {
        VEHICLES.forEach(v => { if (!vStates[v.id].arrived) allDone = false; });
    }

    timerEl.textContent = formatTime(simSeconds);

    if (allDone) {
        raceState = 'finished';
        onAllDone();
    } else {
        requestAnimationFrame(animate);
    }
}

function onArrived(v, s) {
    s.el.classList.add('arrived');
    const statusEl = s.el.querySelector('[data-status]');
    const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰','4ï¸âƒ£','5ï¸âƒ£','6ï¸âƒ£','7ï¸âƒ£'];
    statusEl.textContent = `${medals[s.rank-1]} ç¬¬${s.rank}å`;
    statusEl.classList.add('done');
    s.el.querySelector('[data-banner]').classList.add('show');
}

function onAllDone() {
    showFinishedBtns();
    // æ„å»ºæ’å
    const sorted = VEHICLES.slice().sort((a, b) => vStates[a.id].rank - vStates[b.id].rank);
    const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
    let html = '';
    sorted.forEach((v, i) => {
        const medal = i < 3 ? medals[i] : `${i+1}.`;
        const totalTime = formatTime(SUN_DISTANCE / v.speedKmH * 3600);
        html += `<div>${medal} ${v.icon} ${v.name} â€” ${totalTime}</div>`;
    });
    document.getElementById('finishRanks').innerHTML = html;
    document.getElementById('finishFooter').textContent = 'âš¡å…‰æ¯”ğŸš¶æ­¥è¡Œå¿« 2.16 äº¿å€ï¼å¤ªé˜³çœŸçš„å¥½è¿œå¥½è¿œï¼';
    finishEl.classList.add('show');
}

// ============ æ—¶é—´æ ¼å¼åŒ– ============
function formatTime(seconds) {
    if (seconds < 1) return 'ä¸åˆ°1ç§’';
    if (seconds < 60) {
        return Math.floor(seconds) + 'ç§’';
    }
    if (seconds < 3600) {
        const m = Math.floor(seconds / 60);
        const s = Math.floor(seconds % 60);
        return s > 0 ? `${m}åˆ†${s}ç§’` : `${m}åˆ†é’Ÿ`;
    }
    if (seconds < 86400) {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        return m > 0 ? `${h}å°æ—¶${m}åˆ†` : `${h}å°æ—¶`;
    }
    const days = seconds / 86400;
    if (days < 30) {
        return Math.floor(days) + 'å¤©';
    }
    if (days < 365.25) {
        const months = Math.floor(days / 30.44);
        return months + 'ä¸ªæœˆ';
    }
    const years = seconds / (86400 * 365.25);
    if (years < 10) return years.toFixed(1) + 'å¹´';
    if (years < 1000) return Math.round(years) + 'å¹´';
    return Math.round(years).toLocaleString() + 'å¹´';
}

// ============ æ˜Ÿç©ºèƒŒæ™¯ ============
function createStars() {
    const el = document.getElementById('stars');
    for (let i = 0; i < 100; i++) {
        const s = document.createElement('div');
        s.className = 'star';
        const size = Math.random() * 2.5 + 0.5;
        s.style.cssText = `width:${size}px;height:${size}px;left:${Math.random()*100}%;top:${Math.random()*100}%;animation-delay:${Math.random()*3}s;animation-duration:${2+Math.random()*3}s;`;
        el.appendChild(s);
    }
}

// ============ å¯åŠ¨ ============
init();
</script>
</body>
</html>
